<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원 관리</title>
    <link rel="stylesheet" href="/css/adminInfo.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        function deleteUser(userId) {
            console.log("Deleting user with ID: " + userId); // 로그 추가
            if (confirm("정말로 이 사용자를 삭제하시겠습니까?")) {
                $.ajax({
                    url: '/api/users',
                    method: 'DELETE',
                    data: { userId: userId },
                    success: function(response) {
                        if (response === "success") {
                            alert("사용자가 삭제되었습니다.");
                            location.reload();
                        } else {
                            alert("사용자 삭제에 실패했습니다.");
                        }
                    },
                    error: function(error) {
                        console.error('Error deleting user:', error);
                        alert("사용자 삭제에 실패했습니다.");
                    }
                });
            }
        }

        function viewUserRecipes(userId) {
            window.location.href = `/admin/user/${userId}/recipes`;
        }

        $(document).ready(function() {
            $.ajax({
                url: '/api/users',
                method: 'GET',
                success: function(users) {
                    let tableBody = $('#memberTableBody');
                    users.forEach(function(user) {
                        console.log(user);
                        let row = `
                            <tr>
                                <td>${user.username}</td>
                                <td>${user.userID}</td>
                                <td>${user.email}</td>
                                <td>${user.phoneNumber}</td>
                                <td>
                                    <button class="view-recipes" onclick="viewUserRecipes('${user.userID}')">상세보기</button>
                                    <button class="delete" onclick="deleteUser('${user.userID}')">삭제</button>
                                </td>
                            </tr>
                        `;
                        tableBody.append(row);
                    });
                },
                error: function(error) {
                    console.error('Error fetching users:', error);
                    console.log("Response Text:", error.responseText); // 응답 텍스트 로그 추가
                }
            });
        });
    </script>
</head>
<body>
<header>
    <nav>
        <div class="nav-left">
            <button class="logoBtn" onclick="window.location.href='/adminHome'">
                <img src="https://recipe1.ezmember.co.kr/img/logo4.png" alt="Logo">
            </button>
        </div>
        <div class="nav-right">
            <button class="logout" onclick="window.location.href='/logout'">로그아웃</button>
        </div>
    </nav>
</header>
<main>
    <div class="container">
        <h2>회원 관리 페이지</h2>
        <table>
            <thead>
            <tr>
                <th>이름</th>
                <th>아이디</th>
                <th>이메일</th>
                <th>전화번호</th>
                <th>회원관리</th>
            </tr>
            </thead>
            <tbody id="memberTableBody">
            </tbody>
        </table>
    </div>
</main>
</body>
</html>
